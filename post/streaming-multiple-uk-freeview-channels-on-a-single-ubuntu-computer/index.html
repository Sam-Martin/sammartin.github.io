<!doctype html>
<html lang="en-gb">
  <head>
    <title>Streaming multiple UK Freeview channels on a single Ubuntu computer // Sam Martin</title>
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.64.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Sam Martin" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://sammart.in/css/main.min.a998572a1815565bbca4f2ca9babb1ae248504a1710ee90b7e336857f14fba27.css" />

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-66377745-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Streaming multiple UK Freeview channels on a single Ubuntu computer"/>
<meta name="twitter:description" content="I was recently given the challenge of setting up an IP-TV system for a school’s accommodation block, approximately 40 rooms.
Initially I was very skeptical about the whole affair, even working on the assumption that all the kids had laptops (which was a fair one as they’re all rich kids) my last soireÃ© into streaming video was back in 2003 using the then embryonic shoutcast video support at approximately 160kbps."/>

    <meta property="og:title" content="Streaming multiple UK Freeview channels on a single Ubuntu computer" />
<meta property="og:description" content="I was recently given the challenge of setting up an IP-TV system for a school’s accommodation block, approximately 40 rooms.
Initially I was very skeptical about the whole affair, even working on the assumption that all the kids had laptops (which was a fair one as they’re all rich kids) my last soireÃ© into streaming video was back in 2003 using the then embryonic shoutcast video support at approximately 160kbps." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://sammart.in/post/streaming-multiple-uk-freeview-channels-on-a-single-ubuntu-computer/" />
<meta property="article:published_time" content="2009-08-07T00:00:00+00:00" />
<meta property="article:modified_time" content="2009-08-07T00:00:00+00:00" />


  </head>
  <body>
    <header class="app-header">
      <a href="https://sammart.in/"><img class="app-header-avatar" src="/avatar.jpg" alt="Sam Martin" /></a>
      <h1>Sam Martin</h1>
      <p>Adventures in IT</p>
      <div class="app-header-social">
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Streaming multiple UK Freeview channels on a single Ubuntu computer</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Aug 7, 2009
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          6 min read
        </div></div>
    </header>
    <div class="post-content">
      <p>I was recently given the challenge of setting up an IP-TV system for a school’s accommodation block, approximately 40 rooms.</p>
<p>Initially I was very skeptical about the whole affair, even working on the assumption that all the kids had laptops (which was a fair one as they’re all rich kids) my last soireÃ© into streaming video was back in 2003 using the then embryonic shoutcast video support at approximately 160kbps.</p>
<p>VLC was the natural choice and had recently released the much touted 1.0.0 version so I decided to have a play around with it on my own computer before comitting to the project and claiming I could do it.</p>
<p>My initial results were… not promising, the video jerked and juttered, the message log filled with errors and in certain modes I couldn’t get the client computer to connect at all.</p>
<p>After much tweaking I decided upon <strong>MMS</strong> as the protocol as any Windows PC with XP or above can simply click on an MMS:// link and open it without issues. I also discovered that the key point to resolving the stuttering and artefacting was to <strong>resize</strong> the thing… re-encoding on the fly at native resolution did not work at all.</p>
<p><strong>Final settings:<br>
<span style="font-weight: normal;">Protocol: MMS<br>
</span><span style="font-weight: normal;">Width: 320</span><br>
<span style="font-weight: normal;">Bitrate: 600kbps</span></strong></p>
<p><strong><span style="font-weight: normal;">With the proof of concept under my arm and a computer with six DVB adapters (I used the <a href="http://www.ebuyer.com/product/113946">Happauge Nova-T TD-500</a> x 3) I set about figuring out how to do it in Ubuntu 9.04 Jaunty Jackalope.</span></strong></p>
<p><strong><span style="font-weight: normal;">To cut a long story short, here’s what you need to do:</span></strong></p>
<h1 id="installing-the-programs">Installing the programs</h1>
<p>**<span style="font-weight: normal;">Setup the VLC Installation PPA in <em>System-&gt;Admin-&gt;Software Sources <em>click on the “3rd party” tab and add in the following:<br>
</span></em></em></p>
<p>deb <a href="http://ppa.launchpad.net/c-korn/vlc/ubuntu">http://ppa.launchpad.net/c-korn/vlc/ubuntu</a> jaunty main</p>
<p><strong><span style="font-weight: normal;">Then open a command prompt and enter:<br>
</span></strong></p>
<p>sudo apt-key adv &ndash;keyserver keyserver.ubuntu.com &ndash;recv-keys 7613768D</p>
<p><strong><span style="font-weight: normal;"> If that doesn’t work, these instructions are probably out of date, go to the <a href="http://www.videolan.org">VLC Website</a> for more recent ones.<br>
Now install dvb-apps, kaffeine, smb and VLC by going into:<br>
<em>System-&gt;Admin-&gt;Synaptics Package Manager</em><br>
(smb is <strong>IMPORTANT</strong> as otherwise your windows computers won’t recognise the computer’s hostname)</span></strong></p>
<h1 id="finding-the-channels">Finding the channels</h1>
<p><strong><span style="font-weight: normal;">Open Kaffeine <em>(Applications -&gt; Sound/Video -&gt; Kaffeine)</em>, press C to open Channels, tell it to scan for new channels.<br>
If you can’t do this you’ll have to go into Kaffeine’s DVB settings and tell it which broadcast tower you’re nearest, find that out by putting your postcode in <a href="http://www.digitaluk.co.uk/">here</a>.<br>
Once it’s scanned for new channels add them to the list and double click on the first channel you wish to stream.<br>
Make a note of the </span>Frequency<span style="font-weight: normal;"> and </span>Service ID<span style="font-weight: normal;">, these are what you need to know to tune the correct channel. Don’t worry if two channel’s frequencies are the same, they’ll be differentiated by the Service ID</span></strong></p>
<h1 id="starting-the-vlc-streams-by-command-line">Starting the VLC streams by command line</h1>
<p><span style="font-weight: normal;">Create a shell script file in your Home directory (right click, new document, give it a .sh extension) I called mine <em>loader.sh</em><br>
Open up a command line (<em>Applications-&gt;System Tools</em>) which should open in your Home directory (<em>dir</em> to make sure you can see your shell script file) type <em><strong>sudo chmod +x loader.sh</strong></em>, this changes the permissions on the file to allow you to execute it.<br>
Edit the now executable shell script by double clicking on it and selecting ‘View’</span></p>
<p><span style="font-weight: normal;">Now here’s the tricky part, you need to create a script that will load up an instance of VLC for each channel you’re streaming (yes, I know that you can run multiple streams from one instance, but I assume that with a multi-core processor it’s more efficient to have seperate processes).</span></p>
<p><span style="font-weight: normal;">Mine went along the lines of:</span></p>
<blockquote>
<p>#BBC 1 on adapter 0 port 1234 cvlc dvb:// &ndash;dvb-frequency 706000000 &ndash;dvb-adapter 0 &ndash;program=4163 &ndash;sout &lsquo;#transcode{vcodec=WMV2,vb=800,scale=1,width=320, acodec=wma2,ab=128,channels=2,samplerate=44100}:std {access=mmsh,mux=asfh,dst=0.0.0.0:1234}&rsquo; &amp; #BBC 2 on adapter 1 port 1235 cvlc dvb:// &ndash;dvb-frequency 706000000 -dvb-adapter 1 &ndash;program=4227 &ndash;sout &lsquo;#transcode{vcodec=WMV2,vb=800,scale=1,width=320, acodec=wma2,ab=128,channels=2,samplerate=44100}:std {access=mmsh,mux=asfh,dst=0.0.0.0:1235}&rsquo;</p>
</blockquote>
<p><em>It’s important to ensure this is all on a single line (it can be hard to tell as the default editor has word wrap enabled by default).</em></p>
<p><span style="font-weight: normal;">Now, if you only want to broadcast BBC 1 and BBC2 </span><span style="font-weight: normal;"><strong>and</strong> live in Newbury, you can copy and paste that verbatim, but for everybody else I’ll explain what’s going on.<br>
The most important bits are:<br>
<em>–dvb-frequency</em> Replace this number with the frequency you got from kaffine, don’t forget to add 000 as VLC takes it in hz and Kaffeine gives it in khz<br>
<em>–dvb-program</em> Replace this with the Service ID Kaffeine gave you<br>
*–dvb-adapter * Replace this with the adapter number you wish to tune. You can see what adapters are installed by browsing to /dev/dvb<br>
<em>:1234</em> This is the port which your clients will connect to, I simply increment it by one for each channel I’m broadcasting, BBC1 =1234 BBC2 = 1235. If you have the same port twice bad things will happen, so make sure each one is unique! </span></p>
<p><span style="font-weight: normal;">The bit in red is the simply the output from the final page of the streaming wizard, so if you want to use a different transcoding setup, simply setup the stream through the VLC GUI and copy everything after the equals sign to replace the red section of the command.</span></p>
<p><span style="font-weight: normal;">If you want to add more channels to stream, simply copy the second command (everything from the &amp; to the end of the red quotes) and change the appropriate switches (frequency, program, adapter and port number).<br>
The ampersand is important otherwise the script won’t get past executing the first command.</span></p>
<h1 id="starting-the-script-automatically">Starting the script automatically</h1>
<p><span style="font-weight: normal;">As you’ve already made the script executeable earlier, simply go to:</span></p>
<p><span style="font-weight: normal;"><em>system -&gt; preferences -&gt; startup programs</em></span></p>
<p><span style="font-weight: normal;"><em><span style="font-style: normal;">Add a new one with whatever name you like with the path to your shell script eg:</span></em></span></p>
<p><span style="font-weight: normal;"><em><span style="font-style: normal;"></em>/home/[username]/loader.sh<em></span></em></span></p>
<p><span style="font-weight: normal;"><em><span></em><span style="font-style: normal;">Replacing loader.sh with the name of your script!</span><span>Â </span><em></span></em></span>Now when your computer starts up, it should automatically start streaming TV!</p>
<p>If you want to start the script automatically, first make sure VLC’s not already running (<em>System-&gt;Admin-&gt;Process Manager</em>) and if it is, kill the processes. Then open a command line, navigate to your shell script, then type:</p>
<p>./loader.sh</p>
<p>Replacing loader.sh with the name of your script!</p>
<h1 id="making-a-user-interface">Making a user interface</h1>
<p>Install Apache and the Apache manager (using the Synaptics Package Manager).<br>
Go to the root directory (<em>/var/www</em> by default) and delete whatever’s in there and create a new file called index.html<br>
Edit this and create links to your streams eg:</p>
<p><a href="mms://TV:1234">BBC 1</a> <a href="mms://TV:1235">BBC2</a></p>
<p><span style="line-height: 18px; white-space: pre-wrap;">Where </span><em>TV</em><span style="line-height: 18px; white-space: pre-wrap;"> is the hostname of the computer and </span><em>1234</em><span style="line-height: 18px; white-space: pre-wrap;"> is the port number in question…. I think you can figure out what BBC 1 and 2 are!</span></p>
<p><span style="line-height: 18px; white-space: pre-wrap;">After that it’s just a matter of going to the client PC and putting <em>http://[hostname]</em> into the browser, eg;</span></p>
<p><span style="line-height: 18px; white-space: pre-wrap;"><em>http://TV</em></span></p>
<p><span style="line-height: 18px; white-space: pre-wrap;">and then clicking on the link, which will then open up the channel in Windows Media Player!</span></p>
<p>Obviously with a bit of HTML knowledge you can make it look much prettier.</p>
<p><span style="line-height: 18px; white-space: pre-wrap;">And there we have it, I hope this has been useful to somebody as it took a little while for me to get right the first time round.</span></p>
<p><span style="line-height: 18px; white-space: pre-wrap;">As far as scaling goes I haven’t done a full scale test yet, but a very low spec PC managed to stream to three computers simultaneously without problems so I hope that the quad core beast I setup in the final scenario won’t have any difficulty with 42 users!</span></p>
<p>If you have any success/issues I’d love to hear from you in the comments.</p>

    </div>
    <div class="post-footer">
      <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "sammartin" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  </article>

    </main>
  </body>
</html>
